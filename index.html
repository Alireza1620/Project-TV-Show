<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TV Show Project | Alireza Seifi Shalamzari (Alireza1620)</title>
    <link href="style.css" rel="stylesheet" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  </head>

  <body>
    <div id="root"></div>

    <script>
      let allEpisodes = [];

      // Fetch episodes from TVMaze API
      function fetchEpisodes() {
        return fetch('https://api.tvmaze.com/shows/82/episodes')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .catch(error => {
            showError(error);
            throw error;
          });
      }

      // Show an error message if data fails to load
      function showError(error) {
        const rootElem = document.getElementById("root");
        rootElem.innerHTML = `
          <div>
            <p>There was an error loading the episodes. Please try again later.</p>
            <p>Error details: ${error.message}</p>
          </div>
        `;
      }

      // Set up the page after data is loaded
      function setup() {
        const rootElem = document.getElementById("root");
        rootElem.innerHTML = '<p>Loading episodes...</p>'; // Show loading message

        fetchEpisodes()
          .then(episodes => {
            allEpisodes = episodes;
            makePageForEpisodes(allEpisodes);
          });
      }

      // Function to render the episodes on the page
      function makePageForEpisodes(episodeList) {
        const rootElem = document.getElementById("root");
        rootElem.innerHTML = `
          <div id="search-container">
            <input type="text" id="search-input" placeholder="Search episodes..." aria-label="Search episodes" />
            <button id="search-button">Search</button>
            <select id="episode-select">
              <option value="">Select an episode...</option>
            </select>
            <button id="reset-button" style="display: none;">Show All Episodes</button>
            <p id="search-result-count">Showing ${episodeList.length} episodes</p>
          </div>
          <ul id="episode-list"></ul>
        `;
        populateEpisodes(episodeList);
        populateEpisodeSelect(episodeList);

        // Event listener for the search button
        document.getElementById('search-button').addEventListener('click', () => {
          const searchQuery = document.getElementById('search-input').value.toLowerCase();
          const filteredEpisodes = allEpisodes.filter(episode => 
            episode.name.toLowerCase().includes(searchQuery) || episode.summary.toLowerCase().includes(searchQuery)
          );
          makePageForEpisodes(filteredEpisodes);
        });

        // Event listener for the select dropdown to show the selected episode
        document.getElementById('episode-select').addEventListener('change', (event) => {
          const selectedValue = event.target.value;
          const selectedEpisode = allEpisodes.find(episode => 
            `S${String(episode.season).padStart(2, '0')}E${String(episode.number).padStart(2, '0')}` === selectedValue
          );
          
          if (selectedEpisode) {
            makePageForEpisodes([selectedEpisode]);
          }
        });

        // Event listener for the reset button to show all episodes again
        document.getElementById('reset-button').addEventListener('click', () => {
          makePageForEpisodes(allEpisodes);
          document.getElementById('search-input').value = '';
          document.getElementById('search-result-count').textContent = `Showing ${allEpisodes.length} episodes`;
          document.getElementById('reset-button').style.display = 'none';
        });
      }

      // Populate the list of episodes
      function populateEpisodes(episodeList) {
        const episodeListElem = document.getElementById("episode-list");
        episodeListElem.innerHTML = ''; // Clear previous content

        episodeList.forEach(episode => {
          const episodeElem = document.createElement("li");
          episodeElem.innerHTML = `
            <p><strong>${episode.name}</strong> (S${String(episode.season).padStart(2, '0')}E${String(episode.number).padStart(2, '0')})</p>
            <p>${episode.summary}</p>
            <img src="${episode.image ? episode.image.medium : ''}" alt="${episode.name}" />
          `;
          episodeListElem.appendChild(episodeElem);
        });
      }

      // Populate the select dropdown with episode options
      function populateEpisodeSelect(episodeList) {
        const episodeSelectElem = document.getElementById("episode-select");
        episodeSelectElem.innerHTML = '<option value="">Select an episode...</option>'; // Clear previous options

        episodeList.forEach(episode => {
          const optionElem = document.createElement("option");
          optionElem.value = `S${String(episode.season).padStart(2, '0')}E${String(episode.number).padStart(2, '0')}`;
          optionElem.textContent = `S${String(episode.season).padStart(2, '0')}E${String(episode.number).padStart(2, '0')} - ${episode.name}`;
          episodeSelectElem.appendChild(optionElem);
        });
      }

      // Initialize the page when it loads
      window.onload = setup;
    </script>
  </body>
</html>
